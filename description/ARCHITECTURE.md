# Описание системы

## Компоненты

- Core. В данном компоненте лежат классы-модели объектов нашей системы и классы-репозитории для работы с моделями и
  базой данных.
- API. Данный компонент содержит логику обработки запросов от пользователей. Классы-контроллеры, которые слуюшают
  REST-Endpoint'ы, и классы-сервисы, которые управляют потоком данных.
- Runner. Компонент, отвечающий за проверку программ. Содержит класс-сервис, который создает докер-образ с проверялкой
  для задачи и создает контейнеры с решениями.
- RabbitMQ. Брокер обмена сообщениями между компонентами - между API и Runner.

## Общая схема

![Class diagram](diagrams/img/class-diagram.drawio.svg)

## Core

### Entites-relationships

![ER diagram](diagrams/img/er-diagram.drawio.svg)

- Task. Сущность, содержащая информацию о заданиях. Хранит название, дату публикации, дату крайнего срока сдачи,
  описание и ссылку на идентификатор проверятеля.
- Submission. Сущность, содержащая информацию о посылках студента. Хранит ссылку на задачу, к которой это решение, дату
  посылки, и в последствии результат проверки.
- Checker. Сущность, содержащая информацию о чекере. Хранит содержание Dockerfile и идентификатор.

### Repositories

Классы-репозитории описывают то, как мы будем доставать данные из базы данных. Предполагается использовать `jOOQ`.

## API

Для создания создания и обработки REST-эндпоинтов мы будем использовать Spring.

- submissions
    - `submissions/view`. Просмотреть все. Возвращает список всех попыток.
    - `submissions/{submissionId}`. Просмотреть конкретную. Возвращает детальную информацию о попытки с
      номером `submissionId`.
- tasks
    - `tasks/view`. Просмотреть все. Возвращает список всех заданий.
    - `tasks/{taskId}`. Просмотреть конретную. Возвращает детальную информацию о задании с номером {taskId}.
- teacher
    - `/teacher/uploadChecker`. Позволяет загрузить чекер преподу. Тело: json, представлюящим Dockerfile. Этот
      Dockerfile вместе с генерированным название кладется в базу, и создается event на создание нового докер образа.
- student
    - `/student/uploadSubmission`. Позвоялет загрузить чекер преподавателю. Тело: json, представляющим ссылку на гитхаб.
      Создается новая попытка и кладется в базу, также создается event на проверку решения. `CheckerService` клонирует
      репозиторий и `mount`ит эту папку в новый докер контейнер и запускает проверялку.
      ![Sequence diagram](diagrams/img/sequence-diagram.drawio.svg)

## RUNNER

Runner ожидает, что Dockerfile заканчивается строчкой `ENTRYPOINT [Запуск чекера на папке /solution]`.

- Для создания чекера, достаточно положить Dockerfile и запустить `docker build -t {переданное название} .`
- Для проверки решения достаточно сделать `git clone {url} && docker run -v {repo-name}:/solution {чекер}`.
